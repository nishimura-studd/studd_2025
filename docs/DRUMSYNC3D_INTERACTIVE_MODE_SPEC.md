# DrumSync3D インタラクティブモード仕様書

## 概要
DrumSync3Dにユーザーが手動でサウンドと3Dオブジェクトをトリガーできるインタラクティブモードを追加する。現状の自動BGM再生モードと切り替え可能な設計とする。

## 機能要件

### 1. モード切り替えUI
- **コントローラアイコンボタン**
  - 位置: サウンド制御ボタンの上部
  - 機能: インタラクティブモードへの切り替え
  - 押下時の動作:
    - DrumSync3Dをリセット
    - 全3Dオブジェクトを削除
    - BGM停止
    - カメラをz方向直進のみに変更

### 2. インタラクティブモード画面レイアウト
- **3D表示エリア**: 画面上部2/3
- **コントローラエリア**: 画面下部1/3
- **閉じるボタン**: コントローラエリア内に配置

### 3. コントローラパッド仕様
- **PC版レイアウト**: 2行 × 8列（16個のパッド配置）
- **SP版レイアウト**: 4行 × 4列（16個のパッド配置）
- **総パッド数**: 16個
- **レスポンシブ対応**: ブレイクポイント768px未満でSP版に切り替え
- **各パッドの機能**:
  - サウンド再生
  - 対応する3Dオブジェクト生成
  - キーボードショートカット対応

### 4. サウンドマッピング
各パッドに以下のサウンド-オブジェクトマッピングを割り当て：

```javascript
soundMapping: {
  'kick': 'tree',
  'snare': 'house', 
  'hihat': 'street_light',
  'openHihat': 'road_diamond',
  'synthbass': 'utility_pole',
  'synthlead': 'post',
  'synthpad': 'crosswalk_stripes',
  '808kick': 'vending_machine',
  'glitch': 'guardrail',
  'static': 'bench',
  'distortionblast': 'fence',
  'vocalchop': 'stop',
  'click': 'bollard',
  'sequencer': 'hydrant',
  'metalclick': 'traffic_cone',
  'minimalbass': 'bus_stop_pole'
}
```

**総パッド数**: 16個（bitcrushをdistortionblastで置換）

### 5. キーボードショートカット
2行8列レイアウトに対応したキーマッピング：

#### PC版キー配置
```
上段: [1][2][3][4][5][6][7][8]
下段: [Q][W][E][R][T][Y][U][I]
```

#### キーマッピング詳細
- **上段（数字キー）**: 1=kick, 2=snare, 3=hihat, 4=openHihat, 5=synthbass, 6=synthlead, 7=synthpad, 8=808kick
- **下段（QWERTY）**: Q=glitch, W=static, E=distortionblast, R=vocalchop, T=click, Y=sequencer, U=metalclick, I=minimalbass

### 6. モード終了機能
- **閉じるボタン**: インタラクティブモードを終了
- **復帰動作**: 
  - 自動BGMモードに戻る
  - カメラシステム復元
  - 通常の音響同期3Dオブジェクト生成を再開

## 技術要件

### 1. 状態管理
- モード状態（auto/interactive）の管理
- カメラシステムの状態切り替え
- オーディオシステムの状態管理

### 2. UI コンポーネント
- コントローラアイコンボタンコンポーネント
- パッドグリッドコンポーネント
- 個別パッドコンポーネント
- 閉じるボタンコンポーネント

### 3. 音響システム拡張
- 個別サウンドトリガー機能
- BGMとインタラクティブサウンドの切り替え
- サウンドマッピングの外部化

### 4. 3Dシステム拡張
- 手動オブジェクト生成機能
- カメラモード切り替え機能
- オブジェクトリセット機能

## UI/UX 設計

### コントローラエリア

#### PC版（2行 × 8列）
```
┌─────────────────────────────────────────────────────────────────────┐
│ [Pad1][Pad2][Pad3][Pad4][Pad5][Pad6][Pad7][Pad8]           ×閉じる │
│ [Pad9][Pad10][Pad11][Pad12][Pad13][Pad14][Pad15][Pad16]           │
└─────────────────────────────────────────────────────────────────────┘
```

#### SP版（4行 × 4列）
```
┌─────────────────────────────────────┐
│  [Pad1] [Pad2] [Pad3] [Pad4] [×閉じる] │
│  [Pad5] [Pad6] [Pad7] [Pad8]        │
│  [Pad9] [Pad10][Pad11][Pad12]       │
│  [Pad13][Pad14][Pad15][Pad16]       │
└─────────────────────────────────────┘
```

### パッドデザイン

#### サイズ・レイアウト
- サイズ: 正方形、レスポンシブ
- ラベル: サウンド名を表示

#### カラーパレット（サウンドタイプ別）
- **ドラム系** (kick, snare, hihat, openHihat):
  - デフォルト: `#2d3748` (ダークグレー)
  - ホバー: `#4a5568` (ライトグレー)
  - アクティブ: `#ed8936` (オレンジ)

- **シンセ系** (synthbass, synthlead, synthpad):
  - デフォルト: `#2b6cb0` (ブルー)
  - ホバー: `#3182ce` (ライトブルー)
  - アクティブ: `#63b3ed` (シアン)

- **エフェクト系** (glitch, static, distortionblast):
  - デフォルト: `#c53030` (レッド)
  - ホバー: `#e53e3e` (ライトレッド)
  - アクティブ: `#fc8181` (ピンク)

- **その他** (808kick, vocalchop, click, sequencer, metalclick, minimalbass):
  - デフォルト: `#553c9a` (パープル)
  - ホバー: `#6b46c1` (ライトパープル)
  - アクティブ: `#a78bfa` (ラベンダー)

#### コントローラ背景色
- メイン背景: `#0d1117` (GitHub Dark風)
- パッドエリア背景: `#161b22` (少し明るいダーク)
- 境界線: `#30363d` (サブトルボーダー)

### カメラ制御
- **通常モード**: ガイドスフィア追従、軌道運動
- **インタラクティブモード**: Z軸直進のみ、固定視点

## 実装フェーズ

### Phase 1: 基本構造
1. モード状態管理の実装
2. コントローラUIの基本レイアウト
3. モード切り替えボタン

### Phase 2: コア機能
1. パッドコンポーネント実装
2. サウンドトリガー機能
3. 3Dオブジェクト手動生成

### Phase 3: 統合・最適化
1. キーボードショートカット
2. アニメーション・フィードバック
3. モード間の smooth な切り替え

## 注意事項
- Web Audio APIの制約によりユーザーインタラクション後の初期化が必要
- 既存の自動モード機能を損なわないよう設計
- パフォーマンスへの影響を最小限に抑制
- モバイルデバイスでの操作性も考慮

## 参考資料
- 既存のDrumSync3Dシステムアーキテクチャ
- sound-engine.js のサウンド生成ロジック
- object-spawner.js の3Dオブジェクト生成ロジック